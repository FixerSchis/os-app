{% extends "_template.html" %}

{% block title %}Audit Log - {{ character.name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="audit-log-header">
        <h1>Audit Log for {{ character.name }}</h1>
        <a href="{{ url_for('characters.edit', character_id=character.id) }}" class="btn btn-secondary">Back to Character</a>
    </div>
    
    <div class="audit-log-container">
        <div class="audit-log-entries">
            {% for log in audit_logs %}
            <div class="audit-entry">
                <div class="audit-entry-header">
                    <div class="audit-meta">
                        <div class="audit-timestamp">
                            <i class="bi bi-clock"></i>
                            {{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}
                        </div>
                        <div class="audit-editor">
                            <i class="bi bi-person"></i>
                            {% if log.editor %}
                                {{ log.editor.first_name }}{% if log.editor.surname %} {{ log.editor.surname }}{% endif %}
                                {% if not log.editor.first_name and not log.editor.surname %}{{ log.editor.email }}{% endif %}
                            {% else %}
                                {{ log.editor_user_id }}
                            {% endif %}
                        </div>
                    </div>
                    <div class="audit-action">
                        <span class="badge bg-info">{{ CharacterAuditAction.descriptions()[log.action.value] if log.action else log.action }}</span>
                    </div>
                </div>
                <div class="audit-changes">
                    {{ log.changes }}
                </div>
            </div>
            {% else %}
            <div class="audit-empty">
                <p>No audit log entries found.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
.audit-log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.audit-log-header h1 {
    margin: 0;
    font-size: 2rem;
    color: #333;
}

.audit-log-container {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.audit-log-entries {
    display: flex;
    flex-direction: column;
    gap: 1px;
    background: #e0e0e0;
}

.audit-entry {
    background: #fff;
    padding: 1.5rem;
}

.audit-entry:first-child {
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

.audit-entry:last-child {
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
}

.audit-entry-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    gap: 1rem;
}

.audit-meta {
    display: flex;
    gap: 1.5rem;
    color: #666;
    font-size: 0.9rem;
}

.audit-timestamp,
.audit-editor {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.audit-action .badge {
    font-size: 0.875rem;
    font-weight: 500;
    padding: 0.5em 0.75em;
    border-radius: 4px;
}

.audit-changes {
    font-family: 'Fira Mono', 'Consolas', 'Monaco', monospace;
    font-size: 0.9rem;
    line-height: 1.5;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 6px;
    white-space: pre-wrap;
    word-break: break-word;
}

.audit-empty {
    padding: 2rem;
    text-align: center;
    color: #666;
    font-style: italic;
}

@media (max-width: 768px) {
    .audit-log-header {
        flex-direction: column;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .audit-log-container {
        border-radius: 0;
        margin: 0 -1rem;
    }

    .audit-entry {
        padding: 1rem;
    }

    .audit-entry-header {
        flex-direction: column;
        align-items: flex-start;
    }

    .audit-meta {
        flex-direction: column;
        gap: 0.5rem;
    }

    .audit-changes {
        font-size: 0.85rem;
        padding: 0.75rem;
    }
}
</style>
{% endblock %} 